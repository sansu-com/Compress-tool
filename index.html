<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>PDF Compressor - Custom Size</title>
<style>
    body { font-family: Arial, sans-serif; background: #f7f7f7; text-align: center; padding: 20px; }
    .container { background: white; padding: 20px; border-radius: 8px; max-width: 500px; margin: auto; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
    .ad-space { width: 300px; height: 250px; background: #e0e0e0; margin: 10px auto; display: flex; align-items: center; justify-content: center; color: #666; font-size: 14px; }
    #loading { display: none; font-weight: bold; color: #007BFF; margin-top: 10px; }
    button { padding: 10px 20px; background: #007BFF; color: white; border: none; border-radius: 5px; cursor: pointer; }
    button:hover { background: #0056b3; }
    input[type=number] { width: 100px; padding: 5px; margin: 5px; }
</style>
</head>
<body>

<!-- Top Banner Ad Space -->
<div class="ad-space">300×250 Banner Ad</div>

<div class="container">
    <h2>Compress Your PDF</h2>
    <input type="file" id="pdfInput" accept="application/pdf"><br><br>
    <label>Target Size (KB): </label><input type="number" id="sizeKB" min="0" placeholder="e.g. 500"><br>
    <label>Target Size (MB): </label><input type="number" id="sizeMB" min="0" placeholder="e.g. 2"><br><br>
    <button id="compressBtn">Compress PDF</button>
    <p id="loading">Please wait, compressing PDF...</p>
    <a id="downloadLink" style="display:none;" download="compressed.pdf">
        <button>Download Compressed PDF</button>
    </a>
</div>

<!-- Bottom Banner Ad Space -->
<div class="ad-space">300×250 Banner Ad</div>

<script src="https://unpkg.com/pdf-lib/dist/pdf-lib.min.js"></script>
<script>
document.getElementById('compressBtn').addEventListener('click', async function(event) {
    event.preventDefault();

    const fileInput = document.getElementById('pdfInput');
    const loading = document.getElementById('loading');
    const downloadLink = document.getElementById('downloadLink');

    const sizeKB = parseFloat(document.getElementById('sizeKB').value) || 0;
    const sizeMB = parseFloat(document.getElementById('sizeMB').value) || 0;

    if (!fileInput.files.length) {
        alert("Please select a PDF file.");
        return;
    }
    if (sizeKB <= 0 && sizeMB <= 0) {
        alert("Please enter a target size in KB or MB.");
        return;
    }

    const targetBytes = (sizeKB * 1024) + (sizeMB * 1024 * 1024);

    loading.style.display = "block";
    downloadLink.style.display = "none";

    const file = fileInput.files[0];
    let arrayBuffer = await file.arrayBuffer();

    let pdfDoc = await PDFLib.PDFDocument.load(arrayBuffer);
    let compressionFactor = 0.9;

    let compressedBytes;
    let blob;
    let attempt = 0;

    do {
        attempt++;
        const pages = pdfDoc.getPages();
        pages.forEach(page => {
            page.scaleContent(compressionFactor, compressionFactor);
        });
        compressedBytes = await pdfDoc.save({ useObjectStreams: true });
        blob = new Blob([compressedBytes], { type: 'application/pdf' });

        if (blob.size > targetBytes && compressionFactor > 0.5) {
            compressionFactor -= 0.05;
            pdfDoc = await PDFLib.PDFDocument.load(arrayBuffer); // reload original for next attempt
        } else {
            break;
        }
    } while (blob.size > targetBytes && attempt < 10);

    const url = URL.createObjectURL(blob);
    downloadLink.href = url;
    downloadLink.style.display = "inline-block";
    loading.style.display = "none";
});
</script>

</body>
</html>
